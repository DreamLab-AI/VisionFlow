<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Interactive Wardley Map</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #f5f5f5;
        }

        #container {
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        #header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        h1 {
            font-size: 24px;
            margin-bottom: 8px;
        }

        #controls {
            padding: 15px 20px;
            background: white;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        .control-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        label {
            font-weight: 600;
            color: #333;
        }

        input, select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        button {
            padding: 8px 16px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.2s;
        }

        button:hover {
            background: #764ba2;
        }

        #canvas {
            flex: 1;
            background: white;
            position: relative;
            overflow: hidden;
        }

        svg {
            width: 100%;
            height: 100%;
        }

        .evolution-stage {
            fill-opacity: 0.05;
            pointer-events: none;
        }

        .stage-label {
            font-size: 14px;
            fill: #999;
            pointer-events: none;
            text-anchor: middle;
        }

        .axis-label {
            font-size: 12px;
            fill: #666;
            pointer-events: none;
        }

        .axis-line {
            stroke: #ccc;
            stroke-width: 2;
            stroke-dasharray: 5,5;
        }

        .component {
            cursor: pointer;
            transition: all 0.2s;
        }

        .component-circle {
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        }

        .component:hover .component-circle {
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.2));
            r: 20;
        }

        .component-label {
            font-size: 12px;
            text-anchor: middle;
            pointer-events: none;
            font-weight: 600;
            fill: #333;
        }

        .link {
            stroke: #999;
            stroke-opacity: 0.6;
            stroke-width: 2;
            marker-end: url(#arrowhead);
        }

        .link.strength {
            stroke: #ff6b6b;
            stroke-width: 3;
        }

        .link.weak {
            stroke: #95a5a6;
            stroke-dasharray: 5,5;
        }

        .component.strength .component-circle {
            fill: #51cf66;
            stroke: #2f9e44;
            stroke-width: 3;
        }

        .component.vulnerability .component-circle {
            fill: #ff8787;
            stroke: #d32f2f;
            stroke-width: 3;
        }

        .component.opportunity .component-circle {
            fill: #ffd93d;
            stroke: #f9a825;
            stroke-width: 3;
        }

        .component.threat .component-circle {
            fill: #ff922b;
            stroke: #d9480f;
            stroke-width: 3;
        }

        .component.default .component-circle {
            fill: #667eea;
            stroke: #764ba2;
            stroke-width: 2;
        }

        .tooltip {
            position: absolute;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            max-width: 300px;
            font-size: 12px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .tooltip.show {
            opacity: 1;
        }

        .tooltip-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 6px;
            font-size: 13px;
        }

        .tooltip-item {
            margin-bottom: 4px;
            color: #666;
        }

        .legend {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            font-size: 12px;
        }

        .legend-item {
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid;
        }

        #instructions {
            position: absolute;
            top: 20px;
            left: 20px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            font-size: 12px;
            max-width: 250px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            z-index: 999;
        }

        .info-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            max-width: 350px;
            font-size: 12px;
            z-index: 999;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="header">
            <h1>Interactive Wardley Map</h1>
            <p>Visualizing organizational evolution and strategic positioning</p>
        </div>

        <div id="controls">
            <div class="control-group">
                <label>Filter by Evolution Stage:</label>
                <select id="stageFilter">
                    <option value="">All Stages</option>
                    <option value="Genesis">Genesis</option>
                    <option value="Custom">Custom</option>
                    <option value="Product">Product</option>
                    <option value="Commodity">Commodity</option>
                </select>
            </div>

            <div class="control-group">
                <label>Filter by Insight Type:</label>
                <select id="insightFilter">
                    <option value="">All Components</option>
                    <option value="strength">Strengths</option>
                    <option value="vulnerability">Vulnerabilities</option>
                    <option value="opportunity">Opportunities</option>
                    <option value="threat">Threats</option>
                </select>
            </div>

            <button id="resetZoom">Reset Zoom</button>
            <button id="toggleGrid">Toggle Grid</button>
        </div>

        <div id="canvas">
            <div id="instructions">
                <strong>Controls:</strong><br>
                • Scroll: Zoom<br>
                • Drag: Pan<br>
                • Click: Select component<br>
                • Hover: Details
            </div>

            <div id="infoPanel" class="info-panel" style="display: none;"></div>

            <svg></svg>

            <div class="tooltip"></div>

            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background: #667eea; border-color: #764ba2;"></div>
                    <span>Component</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #51cf66; border-color: #2f9e44;"></div>
                    <span>Strength</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #ff8787; border-color: #d32f2f;"></div>
                    <span>Vulnerability</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #ffd93d; border-color: #f9a825;"></div>
                    <span>Opportunity</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #ff922b; border-color: #d9480f;"></div>
                    <span>Threat</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        const data = {{"nodes": [{"id": "R&D Insight Discovery", "name": "R&D Insight Discovery", "visibility": 1.0, "evolution": 0.5, "description": "Core user need for knowledge discovery", "category": "User Need", "insights": [], "is_strength": false, "is_vulnerability": false, "is_opportunity": false, "is_threat": false, "evolution_stage": "Custom", "visibility_level": "High"}, {"id": "Web Interface", "name": "Web Interface", "visibility": 0.95, "evolution": 0.7, "description": "React/Three.js frontend with 14 subsystems, 85K LOC", "category": "Product", "insights": [], "is_strength": false, "is_vulnerability": false, "is_opportunity": false, "is_threat": false, "evolution_stage": "Product", "visibility_level": "High"}, {"id": "XR Visualization", "name": "XR Visualization", "visibility": 0.85, "evolution": 0.15, "description": "Quest 3/WebXR immersive knowledge work - first mover advantage", "category": "Genesis", "insights": [], "is_strength": true, "is_vulnerability": false, "is_opportunity": false, "is_threat": false, "evolution_stage": "Genesis", "visibility_level": "High"}, {"id": "Real-time Collaboration", "name": "Real-time Collaboration", "visibility": 0.85, "evolution": 0.65, "description": "Multi-WebSocket strategy with Vircadia integration", "category": "Product", "insights": [], "is_strength": false, "is_vulnerability": false, "is_opportunity": false, "is_threat": false, "evolution_stage": "Product", "visibility_level": "High"}, {"id": "Semantic Physics Engine", "name": "Semantic Physics Engine", "visibility": 0.7, "evolution": 0.25, "description": "13 CUDA kernels, OWL-to-force translation, 9 force types", "category": "Custom", "insights": [], "is_strength": true, "is_vulnerability": false, "is_opportunity": false, "is_threat": false, "evolution_stage": "Custom", "visibility_level": "High"}, {"id": "Knowledge Graph Core", "name": "Knowledge Graph Core", "visibility": 0.65, "evolution": 0.4, "description": "Neo4j + Whelk-rs OWL 2 EL reasoning (10-100x faster)", "category": "Custom", "insights": [], "is_strength": false, "is_vulnerability": true, "is_opportunity": false, "is_threat": false, "evolution_stage": "Custom", "visibility_level": "High"}, {"id": "Multi-Agent Orchestration", "name": "Multi-Agent Orchestration", "visibility": 0.6, "evolution": 0.3, "description": "10 agent types, Actix actors, Queen/Worker topology", "category": "Custom", "insights": [], "is_strength": true, "is_vulnerability": false, "is_opportunity": false, "is_threat": false, "evolution_stage": "Custom", "visibility_level": "Medium"}, {"id": "Binary Protocol", "name": "Binary Protocol", "visibility": 0.55, "evolution": 0.5, "description": "28-byte node format, 80% bandwidth reduction, 20Hz broadcast", "category": "Product", "insights": [], "is_strength": false, "is_vulnerability": true, "is_opportunity": false, "is_threat": false, "evolution_stage": "Custom", "visibility_level": "Medium"}, {"id": "GraphRAG System", "name": "GraphRAG System", "visibility": 0.55, "evolution": 0.35, "description": "Microsoft GraphRAG with Leiden clustering, multi-hop reasoning", "category": "Custom", "insights": [], "is_strength": false, "is_vulnerability": false, "is_opportunity": true, "is_threat": false, "evolution_stage": "Custom", "visibility_level": "Medium"}, {"id": "Solid/LDP Pods", "name": "Solid/LDP Pods", "visibility": 0.6, "evolution": 0.2, "description": "Decentralized data pods, privacy-first differentiation", "category": "Genesis", "insights": [], "is_strength": false, "is_vulnerability": false, "is_opportunity": true, "is_threat": false, "evolution_stage": "Genesis", "visibility_level": "Medium"}, {"id": "Domain Ontologies", "name": "Domain Ontologies", "visibility": 0.55, "evolution": 0.3, "description": "OWL 2 EL with SubClassOf attraction, DisjointWith repulsion", "category": "Custom", "insights": [], "is_strength": true, "is_vulnerability": false, "is_opportunity": false, "is_threat": false, "evolution_stage": "Custom", "visibility_level": "Medium"}, {"id": "Agent Memory", "name": "Agent Memory", "visibility": 0.5, "evolution": 0.2, "description": "JSON-LD with PROV ontology: episodic, semantic, procedural", "category": "Genesis", "insights": [], "is_strength": false, "is_vulnerability": false, "is_opportunity": true, "is_threat": false, "evolution_stage": "Genesis", "visibility_level": "Medium"}, {"id": "Broadcast Optimizer", "name": "Broadcast Optimizer", "visibility": 0.45, "evolution": 0.45, "description": "Delta compression, spatial culling, 58% bandwidth savings", "category": "Product", "insights": [], "is_strength": false, "is_vulnerability": false, "is_opportunity": false, "is_threat": false, "evolution_stage": "Custom", "visibility_level": "Medium"}, {"id": "LLM Services", "name": "LLM Services", "visibility": 0.5, "evolution": 0.45, "description": "Z.AI/Anthropic API, worker pool, 30s timeout", "category": "Product", "insights": [], "is_strength": false, "is_vulnerability": false, "is_opportunity": false, "is_threat": true, "evolution_stage": "Custom", "visibility_level": "Medium"}, {"id": "Task Orchestrator", "name": "Task Orchestrator", "visibility": 0.45, "evolution": 0.55, "description": "Actix TaskOrchestratorActor, retry logic, HTTP integration", "category": "Product", "insights": [], "is_strength": false, "is_vulnerability": false, "is_opportunity": false, "is_threat": false, "evolution_stage": "Product", "visibility_level": "Medium"}, {"id": "GPU Memory Manager", "name": "GPU Memory Manager", "visibility": 0.35, "evolution": 0.4, "description": "Pool-based allocation, leak detection, async transfers", "category": "Custom", "insights": [], "is_strength": false, "is_vulnerability": false, "is_opportunity": false, "is_threat": false, "evolution_stage": "Custom", "visibility_level": "Medium"}, {"id": "Neo4j Database", "name": "Neo4j Database", "visibility": 0.3, "evolution": 0.75, "description": "Enterprise graph database, ACID, proven scale", "category": "Product", "insights": [], "is_strength": false, "is_vulnerability": false, "is_opportunity": false, "is_threat": false, "evolution_stage": "Product", "visibility_level": "Low"}, {"id": "CUDA Compute", "name": "CUDA Compute", "visibility": 0.15, "evolution": 0.85, "description": "CUDA 12.0 via cudarc, RTX A6000/Quadro support", "category": "Commodity", "insights": [], "is_strength": false, "is_vulnerability": true, "is_opportunity": false, "is_threat": true, "evolution_stage": "Commodity", "visibility_level": "Low"}, {"id": "Actix Web", "name": "Actix Web", "visibility": 0.2, "evolution": 0.8, "description": "Rust async web framework, WebSocket support", "category": "Commodity", "insights": [], "is_strength": false, "is_vulnerability": false, "is_opportunity": false, "is_threat": false, "evolution_stage": "Commodity", "visibility_level": "Low"}], "links": [{"source": "R&D Insight Discovery", "target": "Web Interface", "type": "dependency"}, {"source": "R&D Insight Discovery", "target": "XR Visualization", "type": "dependency"}, {"source": "Web Interface", "target": "Real-time Collaboration", "type": "dependency"}, {"source": "Web Interface", "target": "Knowledge Graph Core", "type": "dependency"}, {"source": "Web Interface", "target": "Binary Protocol", "type": "dependency"}, {"source": "XR Visualization", "target": "Semantic Physics Engine", "type": "dependency"}, {"source": "XR Visualization", "target": "Real-time Collaboration", "type": "dependency"}, {"source": "Real-time Collaboration", "target": "Binary Protocol", "type": "dependency"}, {"source": "Semantic Physics Engine", "target": "CUDA Compute", "type": "dependency"}, {"source": "Semantic Physics Engine", "target": "Domain Ontologies", "type": "dependency"}, {"source": "Semantic Physics Engine", "target": "GPU Memory Manager", "type": "dependency"}, {"source": "Knowledge Graph Core", "target": "Neo4j Database", "type": "dependency"}, {"source": "Knowledge Graph Core", "target": "Domain Ontologies", "type": "dependency"}, {"source": "Knowledge Graph Core", "target": "Multi-Agent Orchestration", "type": "dependency"}, {"source": "Knowledge Graph Core", "target": "Solid/LDP Pods", "type": "dependency"}, {"source": "Multi-Agent Orchestration", "target": "Task Orchestrator", "type": "dependency"}, {"source": "Multi-Agent Orchestration", "target": "Agent Memory", "type": "dependency"}, {"source": "Multi-Agent Orchestration", "target": "LLM Services", "type": "dependency"}, {"source": "Binary Protocol", "target": "Broadcast Optimizer", "type": "dependency"}, {"source": "GraphRAG System", "target": "Knowledge Graph Core", "type": "dependency"}, {"source": "GraphRAG System", "target": "LLM Services", "type": "dependency"}, {"source": "GraphRAG System", "target": "Neo4j Database", "type": "dependency"}, {"source": "Domain Ontologies", "target": "Neo4j Database", "type": "dependency"}, {"source": "Broadcast Optimizer", "target": "Actix Web", "type": "dependency"}, {"source": "Task Orchestrator", "target": "Actix Web", "type": "dependency"}, {"source": "LLM Services", "target": "CUDA Compute", "type": "dependency"}, {"source": "GPU Memory Manager", "target": "CUDA Compute", "type": "dependency"}]}};

        const width = document.getElementById('canvas').clientWidth;
        const height = document.getElementById('canvas').clientHeight;
        const margin = { top: 80, right: 100, bottom: 100, left: 100 };
        const mapWidth = width - margin.left - margin.right;
        const mapHeight = height - margin.top - margin.bottom;

        // SVG setup
        const svg = d3.select('svg')
            .attr('width', width)
            .attr('height', height);

        // Create main group with margins
        const g = svg.append('g')
            .attr('transform', `translate(${margin.left},${margin.top})`);

        // Add background stages
        const stages = [
            { name: 'Genesis', x: 0, width: 0.15, color: '#f0f0f0' },
            { name: 'Custom', x: 0.15, width: 0.2, color: '#e8e8e8' },
            { name: 'Product', x: 0.35, width: 0.3, color: '#e0e0e0' },
            { name: 'Commodity', x: 0.65, width: 0.35, color: '#d8d8d8' }
        ];

        stages.forEach(stage => {
            g.append('rect')
                .attr('class', 'evolution-stage')
                .attr('x', stage.x * mapWidth)
                .attr('y', 0)
                .attr('width', stage.width * mapWidth)
                .attr('height', mapHeight)
                .attr('fill', stage.color);

            g.append('text')
                .attr('class', 'stage-label')
                .attr('x', (stage.x + stage.width / 2) * mapWidth)
                .attr('y', mapHeight + 30)
                .attr('font-weight', 'bold')
                .text(stage.name);
        });

        // Add axes
        g.append('line')
            .attr('class', 'axis-line')
            .attr('x1', 0)
            .attr('x2', mapWidth)
            .attr('y1', mapHeight)
            .attr('y2', mapHeight);

        g.append('line')
            .attr('class', 'axis-line')
            .attr('x1', 0)
            .attr('x2', 0)
            .attr('y1', 0)
            .attr('y2', mapHeight);

        g.append('text')
            .attr('class', 'axis-label')
            .attr('x', mapWidth / 2)
            .attr('y', mapHeight + 50)
            .attr('text-anchor', 'middle')
            .text('Evolution →');

        g.append('text')
            .attr('class', 'axis-label')
            .attr('x', -mapHeight / 2)
            .attr('y', -50)
            .attr('text-anchor', 'middle')
            .attr('transform', 'rotate(-90)')
            .text('Visibility →');

        // Arrow marker
        svg.append('defs').append('marker')
            .attr('id', 'arrowhead')
            .attr('markerWidth', 10)
            .attr('markerHeight', 10)
            .attr('refX', 8)
            .attr('refY', 3)
            .attr('orient', 'auto')
            .append('polygon')
            .attr('points', '0 0, 10 3, 0 6')
            .attr('fill', '#999');

        // Create simulation
        const simulation = d3.forceSimulation(data.nodes)
            .force('link', d3.forceLink(data.links)
                .id(d => d.id)
                .distance(100)
                .strength(0.3))
            .force('x', d3.forceX(d => d.evolution * mapWidth).strength(0.5))
            .force('y', d3.forceY(d => (1 - d.visibility) * mapHeight).strength(0.5))
            .force('charge', d3.forceManyBody().strength(-200))
            .force('collision', d3.forceCollide().radius(25));

        // Create links
        const link = g.append('g')
            .selectAll('line')
            .data(data.links)
            .join('line')
            .attr('class', 'link');

        // Create nodes
        const node = g.append('g')
            .selectAll('g.component')
            .data(data.nodes)
            .join('g')
            .attr('class', d => 'component ' +
                (d.is_strength ? 'strength' :
                 d.is_vulnerability ? 'vulnerability' :
                 d.is_opportunity ? 'opportunity' :
                 d.is_threat ? 'threat' : 'default'));

        node.append('circle')
            .attr('class', 'component-circle')
            .attr('r', 15);

        node.append('text')
            .attr('class', 'component-label')
            .attr('dy', '0.3em')
            .text(d => d.name.substring(0, 10));

        // Zoom behavior
        const zoom = d3.zoom()
            .on('zoom', (event) => {
                g.attr('transform', event.transform);
            });

        svg.call(zoom);

        document.getElementById('resetZoom').addEventListener('click', () => {
            svg.transition().duration(750).call(
                zoom.transform,
                d3.zoomIdentity
                    .translate(margin.left, margin.top)
            );
        });

        // Drag behavior
        node.call(d3.drag()
            .on('start', dragstarted)
            .on('drag', dragged)
            .on('end', dragended));

        function dragstarted(event, d) {
            if (!event.active) simulation.alphaTarget(0.3).restart();
            d.fx = d.x;
            d.fy = d.y;
        }

        function dragged(event, d) {
            d.fx = event.x;
            d.fy = event.y;
        }

        function dragended(event, d) {
            if (!event.active) simulation.alphaTarget(0);
            d.fx = null;
            d.fy = null;
        }

        // Update positions
        simulation.on('tick', () => {
            link
                .attr('x1', d => d.source.x)
                .attr('y1', d => d.source.y)
                .attr('x2', d => d.target.x)
                .attr('y2', d => d.target.y);

            node.attr('transform', d => `translate(${d.x},${d.y})`);
        });

        // Tooltip
        const tooltip = document.querySelector('.tooltip');

        node.on('mouseover', (event, d) => {
            tooltip.classList.add('show');
            tooltip.innerHTML = `
                <div class="tooltip-title">${d.name}</div>
                <div class="tooltip-item"><strong>Stage:</strong> ${d.evolution_stage}</div>
                <div class="tooltip-item"><strong>Visibility:</strong> ${d.visibility_level}</div>
                <div class="tooltip-item"><strong>Category:</strong> ${d.category}</div>
                ${d.description ? `<div class="tooltip-item">${d.description}</div>` : ''}
            `;
            const rect = event.target.getBoundingClientRect();
            tooltip.style.left = (rect.left + 20) + 'px';
            tooltip.style.top = (rect.top - 20) + 'px';
        })
        .on('mousemove', (event) => {
            tooltip.style.left = (event.clientX + 20) + 'px';
            tooltip.style.top = (event.clientY - 20) + 'px';
        })
        .on('mouseout', () => {
            tooltip.classList.remove('show');
        })
        .on('click', (event, d) => {
            const panel = document.getElementById('infoPanel');
            panel.style.display = 'block';
            panel.innerHTML = `
                <strong>${d.name}</strong><br>
                Stage: ${d.evolution_stage}<br>
                Visibility: ${d.visibility_level}<br>
                <br>
                <small>${d.description || 'No description'}</small>
            `;
        });

        // Filters
        document.getElementById('stageFilter').addEventListener('change', (e) => {
            const stage = e.target.value;
            node.style('opacity', d => !stage || d.evolution_stage === stage ? 1 : 0.2);
        });

        document.getElementById('insightFilter').addEventListener('change', (e) => {
            const insight = e.target.value;
            node.style('opacity', d => {
                if (!insight) return 1;
                if (insight === 'strength') return d.is_strength ? 1 : 0.2;
                if (insight === 'vulnerability') return d.is_vulnerability ? 1 : 0.2;
                if (insight === 'opportunity') return d.is_opportunity ? 1 : 0.2;
                if (insight === 'threat') return d.is_threat ? 1 : 0.2;
                return 1;
            });
        });

        document.getElementById('toggleGrid').addEventListener('click', () => {
            g.selectAll('.evolution-stage').style('opacity',
                (_, i, nodes) => nodes[0].style.opacity === '0.05' ? 0 : 0.05
            );
        });
    </script>
</body>
</html>