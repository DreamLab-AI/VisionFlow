services:
  webxr:
    container_name: logseq_spring_thing_webxr
    build:
      context: .
      dockerfile: Dockerfile.dev
      args:
        CUDA_ARCH: ${CUDA_ARCH:-86}
    volumes:
      - ./client:/app/client
      - ./data/markdown:/app/data/markdown
      - ./data/metadata:/app/data/metadata
      - ./data/user_settings:/app/user_settings
      - ./data/settings.yaml:/app/settings.yaml
      - npm-cache:/root/.npm
      - cargo-cache:/root/.cargo/registry
      - cargo-git-cache:/root/.cargo/git
    env_file:
      - .env
    environment:
      - NVIDIA_VISIBLE_DEVICES=GPU-553dc306-dab3-32e2-c69b-28175a6f4da6
      - NVIDIA_GPU_UUID=GPU-553dc306-dab3-32e2-c69b-28175a6f4da6
      - RUST_LOG=trace
      - NODE_ENV=development
      - VITE_DEV_SERVER_PORT=3001
      - VITE_API_PORT=4000
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              capabilities: [compute,utility]
              device_ids: ['0']
    ports:
      - "3001:3001"  # Vite dev server
      - "4000:4000"  # Nginx/Backend API
      - "24678:24678"  # Vite HMR
    networks:
      - docker_ragflow

networks:
  docker_ragflow:
    external: true

volumes:
  npm-cache:
  cargo-cache:
  cargo-git-cache:
