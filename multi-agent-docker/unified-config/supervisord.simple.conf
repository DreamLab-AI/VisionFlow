[supervisord]
nodaemon=true
logfile=/var/log/supervisord.log
pidfile=/var/run/supervisord.pid
childlogdir=/var/log/supervisor
user=root

[unix_http_server]
file=/var/run/supervisor.sock
chmod=0700

[supervisorctl]
serverurl=unix:///var/run/supervisor.sock

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

# ============================================================================
# Core Services
# ============================================================================

# DBus Daemon
[program:dbus]
command=/usr/bin/dbus-daemon --system --nofork
user=root
autostart=true
autorestart=true
priority=10
stdout_logfile=/var/log/dbus.log
stderr_logfile=/var/log/dbus.error.log

# SSH Server
[program:sshd]
command=/usr/sbin/sshd -D -e
user=root
autostart=true
autorestart=true
priority=50
stdout_logfile=/var/log/sshd.log
stderr_logfile=/var/log/sshd.error.log

# VNC Server
[program:xvnc]
command=/usr/bin/vncserver :1 -geometry 1920x1080 -depth 24 -localhost no -SecurityTypes None
user=devuser
environment=HOME="/home/devuser",USER="devuser",DISPLAY=":1"
autostart=true
autorestart=true
priority=100
stdout_logfile=/var/log/xvnc.log
stderr_logfile=/var/log/xvnc.error.log

# XFCE4 Desktop
[program:xfce4]
command=/usr/bin/startxfce4
user=devuser
environment=HOME="/home/devuser",USER="devuser",DISPLAY=":1"
autostart=true
autorestart=true
priority=200
stdout_logfile=/var/log/xfce4.log
stderr_logfile=/var/log/xfce4.error.log

# Management API
[program:management-api]
command=/usr/bin/node /opt/management-api/server.js
directory=/opt/management-api
user=devuser
environment=HOME="/home/devuser",PORT="9090",NODE_ENV="production"
autostart=true
autorestart=true
priority=300
stdout_logfile=/var/log/management-api.log
stderr_logfile=/var/log/management-api.error.log

# tmux Auto-Start
[program:tmux-autostart]
command=/bin/bash -c "sleep 5 && /home/devuser/.config/tmux-autostart.sh"
user=devuser
environment=HOME="/home/devuser",USER="devuser",WORKSPACE="/home/devuser/workspace",AGENTS_DIR="/home/devuser/agents"
autostart=true
autorestart=false
priority=900
stdout_logfile=/var/log/tmux-autostart.log
stderr_logfile=/var/log/tmux-autostart.error.log
